<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>

<title>World[tm]</title>
<link rel="stylesheet" href="c256.css" type="text/css" media="screen" title="256 Color Style Sheet"/>
<style type="text/css">
 .c0 {color:#000000} .c1 {color:#800000} .c2 {color:#008000} .c3 {color:#808000} .c4 {color:#000080} .c5 {color:#800080} .c6 {color:#008080} .c7 {color:#c0c0c0} .c8 {color:#808080} .c9 {color:#ff0000} .c10 {color:#00ff00} .c11 {color:#ffff00} .c12 {color:#0000ff} .c13 {color:#ff00ff} .c14 {color:#00ffff} .c15 {color:#ffffff} .c16 {color:#000000} .c17 {color:#00005f} .c18 {color:#000087} .c19 {color:#0000af} .c20 {color:#0000d7} .c21 {color:#0000ff} .c22 {color:#005f00} .c23 {color:#005f5f} .c24 {color:#005f87} .c25 {color:#005faf} .c26 {color:#005fd7} .c27 {color:#005fff} .c28 {color:#008700} .c29 {color:#00875f} .c30 {color:#008787} .c31 {color:#0087af} .c32 {color:#0087d7} .c33 {color:#0087ff} .c34 {color:#00af00} .c35 {color:#00af5f} .c36 {color:#00af87} .c37 {color:#00afaf} .c38 {color:#00afd7} .c39 {color:#00afff} .c40 {color:#00d700} .c41 {color:#00d75f} .c42 {color:#00d787} .c43 {color:#00d7af} .c44 {color:#00d7d7} .c45 {color:#00d7ff} .c46 {color:#00ff00} .c47 {color:#00ff5f} .c48 {color:#00ff87} .c49 {color:#00ffaf} .c50 {color:#00ffd7} .c51 {color:#00ffff} .c52 {color:#5f0000} .c53 {color:#5f005f} .c54 {color:#5f0087} .c55 {color:#5f00af} .c56 {color:#5f00d7} .c57 {color:#5f00ff} .c58 {color:#5f5f00} .c59 {color:#5f5f5f} .c60 {color:#5f5f87} .c61 {color:#5f5faf} .c62 {color:#5f5fd7} .c63 {color:#5f5fff} .c64 {color:#5f8700} .c65 {color:#5f875f} .c66 {color:#5f8787} .c67 {color:#5f87af} .c68 {color:#5f87d7} .c69 {color:#5f87ff} .c70 {color:#5faf00} .c71 {color:#5faf5f} .c72 {color:#5faf87} .c73 {color:#5fafaf} .c74 {color:#5fafd7} .c75 {color:#5fafff} .c76 {color:#5fd700} .c77 {color:#5fd75f} .c78 {color:#5fd787} .c79 {color:#5fd7af} .c80 {color:#5fd7d7} .c81 {color:#5fd7ff} .c82 {color:#5fff00} .c83 {color:#5fff5f} .c84 {color:#5fff87} .c85 {color:#5fffaf} .c86 {color:#5fffd7} .c87 {color:#5fffff} .c88 {color:#870000} .c89 {color:#87005f} .c90 {color:#870087} .c91 {color:#8700af} .c92 {color:#8700d7} .c93 {color:#8700ff} .c94 {color:#875f00} .c95 {color:#875f5f} .c96 {color:#875f87} .c97 {color:#875faf} .c98 {color:#875fd7} .c99 {color:#875fff} .c100 {color:#878700} .c101 {color:#87875f} .c102 {color:#878787} .c103 {color:#8787af} .c104 {color:#8787d7} .c105 {color:#8787ff} .c106 {color:#87af00} .c107 {color:#87af5f} .c108 {color:#87af87} .c109 {color:#87afaf} .c110 {color:#87afd7} .c111 {color:#87afff} .c112 {color:#87d700} .c113 {color:#87d75f} .c114 {color:#87d787} .c115 {color:#87d7af} .c116 {color:#87d7d7} .c117 {color:#87d7ff} .c118 {color:#87ff00} .c119 {color:#87ff5f} .c120 {color:#87ff87} .c121 {color:#87ffaf} .c122 {color:#87ffd7} .c123 {color:#87ffff} .c124 {color:#af0000} .c125 {color:#af005f} .c126 {color:#af0087} .c127 {color:#af00af} .c128 {color:#af00d7} .c129 {color:#af00ff} .c130 {color:#af5f00} .c131 {color:#af5f5f} .c132 {color:#af5f87} .c133 {color:#af5faf} .c134 {color:#af5fd7} .c135 {color:#af5fff} .c136 {color:#af8700} .c137 {color:#af875f} .c138 {color:#af8787} .c139 {color:#af87af} .c140 {color:#af87d7} .c141 {color:#af87ff} .c142 {color:#afaf00} .c143 {color:#afaf5f} .c144 {color:#afaf87} .c145 {color:#afafaf} .c146 {color:#afafd7} .c147 {color:#afafff} .c148 {color:#afd700} .c149 {color:#afd75f} .c150 {color:#afd787} .c151 {color:#afd7af} .c152 {color:#afd7d7} .c153 {color:#afd7ff} .c154 {color:#afff00} .c155 {color:#afff5f} .c156 {color:#afff87} .c157 {color:#afffaf} .c158 {color:#afffd7} .c159 {color:#afffff} .c160 {color:#d70000} .c161 {color:#d7005f} .c162 {color:#d70087} .c163 {color:#d700af} .c164 {color:#d700d7} .c165 {color:#d700ff} .c166 {color:#d75f00} .c167 {color:#d75f5f} .c168 {color:#d75f87} .c169 {color:#d75faf} .c170 {color:#d75fd7} .c171 {color:#d75fff} .c172 {color:#d78700} .c173 {color:#d7875f} .c174 {color:#d78787} .c175 {color:#d787af} .c176 {color:#d787d7} .c177 {color:#d787ff} .c178 {color:#d7af00} .c179 {color:#d7af5f} .c180 {color:#d7af87} .c181 {color:#d7afaf} .c182 {color:#d7afd7} .c183 {color:#d7afff} .c184 {color:#d7d700} .c185 {color:#d7d75f} .c186 {color:#d7d787} .c187 {color:#d7d7af} .c188 {color:#d7d7d7} .c189 {color:#d7d7ff} .c190 {color:#d7ff00} .c191 {color:#d7ff5f} .c192 {color:#d7ff87} .c193 {color:#d7ffaf} .c194 {color:#d7ffd7} .c195 {color:#d7ffff} .c196 {color:#ff0000} .c197 {color:#ff005f} .c198 {color:#ff0087} .c199 {color:#ff00af} .c200 {color:#ff00d7} .c201 {color:#ff00ff} .c202 {color:#ff5f00} .c203 {color:#ff5f5f} .c204 {color:#ff5f87} .c205 {color:#ff5faf} .c206 {color:#ff5fd7} .c207 {color:#ff5fff} .c208 {color:#ff8700} .c209 {color:#ff875f} .c210 {color:#ff8787} .c211 {color:#ff87af} .c212 {color:#ff87d7} .c213 {color:#ff87ff} .c214 {color:#ffaf00} .c215 {color:#ffaf5f} .c216 {color:#ffaf87} .c217 {color:#ffafaf} .c218 {color:#ffafd7} .c219 {color:#ffafff} .c220 {color:#ffd700} .c221 {color:#ffd75f} .c222 {color:#ffd787} .c223 {color:#ffd7af} .c224 {color:#ffd7d7} .c225 {color:#ffd7ff} .c226 {color:#ffff00} .c227 {color:#ffff5f} .c228 {color:#ffff87} .c229 {color:#ffffaf} .c230 {color:#ffffd7} .c231 {color:#ffffff} .c232 {color:#080808} .c233 {color:#121212} .c234 {color:#1c1c1c} .c235 {color:#262626} .c236 {color:#303030} .c237 {color:#3a3a3a} .c238 {color:#444444} .c239 {color:#4e4e4e} .c240 {color:#585858} .c241 {color:#626262} .c242 {color:#6c6c6c} .c243 {color:#767676} .c244 {color:#808080} .c245 {color:#8a8a8a} .c246 {color:#949494} .c247 {color:#9e9e9e} .c248 {color:#a8a8a8} .c249 {color:#b2b2b2} .c250 {color:#bcbcbc} .c251 {color:#c6c6c6} .c252 {color:#d0d0d0} .c253 {color:#dadada} .c254 {color:#e4e4e4} .c255 {color:#eeeeee}
 #map {
  color: #888;
  background-color: #000;
  font-family:fixedsys,monospace;
  font-size: .5em
 }
 #chat p {border:0;
          padding:0;
          margin:0;
          font-family:fixedsys,monospace;
          font-size: .5em }
 .clearboth { clear:both }
</style>

<script type="text/javascript">//<![CDATA[

 var shifty = null;
 var shiftx = null;
 var first = 1

 function moveWindow (e) {
  var box = document.getElementById('box');
     if (e.shiftKey) {
       if (shifty == null) {
          if (first == 1) {
            box.style.setProperty('position', 'absolute');
            box.style.setProperty('left', box.offsetLeft + 'px');
            box.style.setProperty('top', box.offsetTop + 'px');
            first = 0;
          }
          shiftx = e.clientX - parseInt(box.style.left);
          shifty = e.clientY - parseInt(box.style.top);
       }
      //var ne = document.createTextNode("(" + box.style.left + " " + box.style.top + ")");
      //document.getElementById('chat').appendChild(ne);

       box.style.left = e.clientX - shiftx + "px";
       box.style.top = e.clientY - shifty + "px";

     } else {
       shifty = shiftx = null; // Reset window movement sentinels/state vars.
     }
 }
 /* Render a map given an XML map block
    <m><r><c f="foreground color" c="character"/>...</r>...</m>
  */
 var walkCount=0;
 function UpdateMapHandler() {
   if (this.readyState == 4  &&  this.status == 200  &&  this.responseXML != null) {
     /* Clear the map section on the page */
     document.getElementById('map').innerHTML = "";
     /* Consider the map element's children */
     var mapElement = this.responseXML.firstChild.childNodes; // <m>...</m>
     for (var i=0; i < mapElement.length; ++i) {
       /* Consider the row element's children */
       var rowElement = mapElement[i].childNodes; // <r>...</r>
       for (var j=0; j < rowElement.length; ++j) {
         /* Consider a character element and it's color and character attributes */
         var charElement = rowElement[j]; // <c f="" c=""/>
         var colorStr = parseInt(charElement.getAttribute('f'));
         var character = charElement.getAttribute('c');
         if (character == " ") { character = String.fromCharCode(160); }
         if (!character) character = "?";
         /* Create a new span element representing  the new colored character */
         var newSpanElement = document.createElement('span');
         newSpanElement.setAttribute('class', 'c' + colorStr);
         newSpanElement.insertAdjacentText('beforeEnd', character);
         /* Insert the new span element into the map section on the page */
         document.getElementById('map').appendChild(newSpanElement);
       }
       /* Each row requires a <br/> */
       document.getElementById('map').appendChild(document.createElement('br'));
     }
     /* Start the map update request cycle again */
     document.getElementById('count').innerHTML = walkCount++;
     //setTimeout(MapLoaderLoop, 0);
     MapLoaderLoop();
   }
 }

 function MapLoaderLoop () {
   var client = new XMLHttpRequest();
   client.onreadystatechange = UpdateMapHandler;
   if (walkCount) // Wait for map to update
     client.open('GET', 'map', true);
   else // First time request for map always returns a map
     client.open('GET', 'map0', true);
   client.send();
 }

 function walk (event)
 {
    var charcode;
    if (event && event.which) { // Chrome/Mozilla
        charcode = event.which;
    }
    else if (event && !event.which) { // IE
        charcode = event.keyCode;
    }

    /* Write to the ID block 'walk' the char code */
    document.getElementById('walk').innerHTML = charcode.toString();

    /* Send the walk command to the world entity */
    var client = new XMLHttpRequest();
    var doit = 1;
    if      (charcode == 72 || charcode == 37) client.open('HEAD', 'walk+4', true);
    else if (charcode == 74 || charcode == 40) client.open('HEAD', 'walk+6', true);
    else if (charcode == 75 || charcode == 38) client.open('HEAD', 'walk+2', true);
    else if (charcode == 76 || charcode == 39) client.open('HEAD', 'walk+0', true);
    else { doit = 0 }
    if (doit) {
      client.onreadystatechange = function empty(){};
      client.send();
    }
 }

 function UpdateChatHandler() {
   if (this.readyState == 4  &&  this.status == 200  &&  this.responseText != null) {
     /* Clear the map section on the page */
     var ne = document.createElement("p")
     ne.innerText = this.responseText;
    var chatBox = document.getElementById('chat')
     chatBox.appendChild(ne);
     chatBox.scrollTop = chatBox.scrollHeight;
     ChatLoaderLoop();
   }
 }

 function ChatLoaderLoop () {
   var client = new XMLHttpRequest();
   client.onreadystatechange = UpdateChatHandler;
   if (walkCount) // Wait for map to update
     client.open('GET', 'chat', true);
   else // First time request for map always returns a map
     client.open('GET', 'chat0', true);
   client.send();
 }

 function talkHandler (e, f) {
   if (e.keyCode == 13) {
     var client = new XMLHttpRequest()
     client.open('POST', 'talk', true)
     client.setRequestHeader("Content-type", "text/html")
     client.send(f.value)
     f.value = ""
   }
 }


 window.onload = function () {
  MapLoaderLoop();
  ChatLoaderLoop();
 }

//]]></script>

</head><body style="cursor:url('http://72.14.188.107:7180/lambda16.cur'), pointer">
<div id='box' style="float:right" onmousemove="moveWindow(event)">
<div id='map' style="display:inline-block" tabindex="1" onkeydown="walk(event)">
..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..<br/>
,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,<br/>
..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..<br/>
,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,<br/>
..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..<br/>
,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,<br/>
..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..<br/>
,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,<br/>
..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..<br/>
,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,<br/>
..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..<br/>
,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,<br/>
..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..<br/>
,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,<br/>
..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..<br/>
,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,<br/>
..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..<br/>
,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,<br/>
..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..<br/>
,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,<br/>
..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..<br/>
,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,<br/>
..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..<br/>
,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,<br/>
..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..,,..<br/>
</div><br/>
<i id="walk">Walk with cursor/VI keys</i>
<b id="count"></b>
</div>
<div id='chat' style="overflow:scroll; height:9em"></div>
<input type="text" value='' size="60" onkeypress="talkHandler(event,this)"/>

<div style='text-align:center'>
<br/>
 <div style='clear:both; font-size:smaller;'>
  <a href='http://validator.w3.org/check/referer'>[XHTML 1.0]</a> &nbsp;
  <a href='http://jigsaw.w3.org/css-validator/check/referer/'>[CSS 2.1]</a>
 </div>
</div>

</body></html>
